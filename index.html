<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>My Docs</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/fontawesome.min.css" rel="stylesheet">
        <link href="css/brands.min.css" rel="stylesheet">
        <link href="css/solid.min.css" rel="stylesheet">
        <link href="css/v4-font-face.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">My Docs</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#practica-25-proxy-inverso-y-balanceo-de-carga-con-ssl-en-nginx" class="nav-link">Práctica 2.5 - Proxy inverso y balanceo de carga con SSL en NGINX</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#configurar-cifrado-con-ssl" class="nav-link">Configurar cifrado con SSL</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cuestiones-finales" class="nav-link">Cuestiones finales</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="practica-25-proxy-inverso-y-balanceo-de-carga-con-ssl-en-nginx">Práctica 2.5 - Proxy inverso y balanceo de carga con SSL en NGINX</h1>
<h2 id="configurar-cifrado-con-ssl">Configurar cifrado con SSL</h2>
<p>Para conseguir que la conexión entre los clientes y nuestro servidor sea segura, 
debemos configurar el cifrado SSL en nuestro proxy inverso. Para ello, crearemos 
un certificado digital con la herramienta OpenSSL.</p>
<pre><code class="language-console">sudo mkdir /etc/nginx/ssl   # Creamos un directorio para almacenar el certificado y la clave privada del servidor.
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/server.key -out /etc/nginx/ssl/server.crt
</code></pre>
<p>Y se nos pedirá que indiquemos una serie de datos:</p>
<p><img alt="Creación certificado con SSL" src="images/creacion_certificado.png" /></p>
<p>Tras crear el certificado y la clave privada, será necesario añadir algunas líneas en el archivo de configuración 
localizado en /etc/nginx/sites-available. Esta será la nueva configuración:</p>
<p><img alt="Nueva configuración" src="images/conf_ssl.png" /></p>
<p>Permitimos la conectividad a través del puerto 443 con ufw ejecutando:</p>
<pre><code class="language-console">sudo ufw allow 443/tcp
</code></pre>
<p>Ahora, si intentamos acceder desde el navegador de nuestra máquina anfitriona, aparecerá una advertencia: </p>
<p><img alt="Advertencia de acceso" src="images/advertencia_acceso.png" /></p>
<p>Esto se debe a que el navegador no reconoce a la organización que expide nuestro certificado como fiable, pero 
no impide que entremos a la página y visualicemos el contenido.</p>
<p>Además, si entramos a la información de seguridad, podemos comprobar que efectivamente la conexión está ahora cifrada:</p>
<p><img alt="Información de seguridad" src="images/inf_seguridad.png" /></p>
<p>Y también podemos consultar los datos del certificado:</p>
<p><img alt="Información del certificado" src="images/inf_certificado.png" /></p>
<p>Actualmente, sólo podemos acceder al contenido a través de HTTPS ya que el proxy sólo "escucha" a través del puerto 443. 
Podemos también hacer que escuche peticiones HTTP por el puerto 80 y redirigirles hacia una conexión segura.</p>
<p>Para ello, volvemos a modificar el archivo de configuración de /etc/nginx/sites-available y le agregamos el siguiente bloque: </p>
<pre><code class="language-console">server {
    listen 80;
    server_name balanceo;
    access_log /var/log/nginx/http_access.log;
    return 301 https://$host$request_uri;
}
</code></pre>
<p>Por una cuestión del caché de los navegadores, es posible que entre las cabeceras no encontremos 
el código HTTP que esperamos (301), ya que en lugar de tratar de solicitar un recurso del servidor, 
se está cargando información almacenada en caché para ahorrar recursos. Para evitar este problema, 
podemos utilizar curl para comprobar que la redirección se está realizando correctamente:</p>
<p><img alt="Comprobación de redirección con curl" src="images/comprobacion_cabecera.png" /></p>
<p>Donde se nos indica que el contenido al que tratamos de acceder no se encuentra en 192.168.0.22:80 sino 
que deberíamos tratar de acceder a él desde https://192.168.0.22/.</p>
<h2 id="cuestiones-finales">Cuestiones finales</h2>
<h3 id="cuestion-1">Cuestión 1</h3>
<p>El error 'ERR_SSL_PROTOCOL_ERROR' indica que algo está impidiendo el encriptado de la conexión con la página, a pesar de que existe 
un certificado digital SSL que debería estar llevando la tarea de encriptado. La manera de solucionarlo será eliminar tanto el certificado 
como la clave privada del servidor (en este caso almacenadas en /etc/nginx/ssl/enrico-berlinguer) y generar un certificado y clave 
nuevos utilizando OpenSSL.</p>
<h3 id="cuestion-2">Cuestión 2</h3>
<p>Cuando el navegador arroja la advertencia NET::ERR_CERT_REVOKED al intentar acceder a un sitio web, es indicativo de que el servidor ha 
devuelto unas credenciales incorrectas. Esto puede deberse a que un tercero esté intentando hacerse pasar por el propietario del dominio 
al que estamos intentando acceder o a que la entidad certificadora del dominio le haya retirado su certificado SSL o que el certificado se 
haya expedido al sitio web equivocado, haciendo que las credenciales sean efectivamente erróneas.</p>
<p>Para solucionar este problema, debemos ponernos en contacto con la entidad certificadora que expidió el certificado que está provocando el 
error y nos emitan un nuevo certificado correcto para nuestro sitio web.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js"></script>
        <script src="search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.6.1
Build Date UTC : 2024-11-07 07:47:00.322724+00:00
-->
